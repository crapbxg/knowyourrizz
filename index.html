<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rizz Calculator</title>
<style>
  body{font-family:Arial, Helvetica, sans-serif;background:#f4f4f6;color:#111;margin:0;padding:0}
  header{background:#111;color:#fff;padding:12px 20px;display:flex;justify-content:space-between;align-items:center}
  nav a{color:#fff;text-decoration:none;font-size:14px;margin-left:16px}
  .container{padding:24px;display:flex;justify-content:center}
  .card{width:820px;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
  h1{font-size:22px;margin:0 0 8px}
  label{display:block;margin-top:12px;font-weight:600}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  input, select, button{padding:8px;border:1px solid #ddd;border-radius:6px}
  input[type=number]{width:140px}
  button{background:#111;color:#fff;border:0;padding:10px 14px;cursor:pointer}
  .types{display:flex;gap:8px;margin-top:8px}
  .type{padding:8px;border:1px solid #eee;border-radius:6px;cursor:pointer;user-select:none}
  .type.sel{border-color:#111;background:#f0f0f0}
  .result{margin-top:16px;padding:12px;background:#f7fbff;border:1px solid #e6f0ff;border-radius:8px}
  .small{font-size:13px;color:#666;margin-top:6px}
  .muted{color:#666}
  .flex-sb{display:flex;gap:12px}
  .box{flex:1;padding:8px;border-radius:6px;background:#fff;border:1px solid #eee}
  .privacy{font-size:12px;color:#444;margin-top:8px}
  @media(max-width:920px){.card{width:100%}.flex-sb{flex-direction:column}}
</style>
</head>
<body>
  <header>
    <h1 style="margin:0;font-size:20px">Rizz Calculator</h1>
    <nav>
      <a href="about.html">About Developer</a>
    </nav>
  </header>

  <div class="container">
    <div class="card">
      <h1 style="margin-top:0">Rizz Calculator</h1>
      <div class="small muted">For users 18+. Enter your name, gender, country (India / United States / World), height, weight and age. This tool is for fun and for statistical curiosity only.</div>

      <label>Your name (required)</label>
      <div class="row">
        <input id="name" type="text" placeholder="e.g. Rahul" />
      </div>

      <label>Are you</label>
      <select id="gender">
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>

      <label>Country (local stats)</label>
      <select id="country">
        <option value="India">India</option>
        <option value="United States">United States</option>
      </select>

      <label>Height — enter cm OR feet'in (examples: 170 or 5'8)</label>
      <div class="row">
        <input id="height" type="text" placeholder="e.g. 170 or 5'8" />
      </div>

      <label>Weight (kg)</label>
      <div class="row">
        <input id="weight" type="number" placeholder="kg" min="30" max="300" />
      </div>

      <label>Age (years, required)</label>
      <div class="row">
        <input id="age" type="number" placeholder="age" min="18" max="80" />
      </div>

      <label>Body type (optional) — click to choose (or leave for suggestion)</label>
      <div class="types" id="bodytypes">
        <div class="type sel" data-val="fit">Fit</div>
        <div class="type" data-val="average">Average</div>
        <div class="type" data-val="stocky">Stocky</div>
        <div class="type" data-val="slim">Slim</div>
      </div>

      <div style="margin-top:12px"><button id="calc">Calculate</button></div>

      <div id="result" class="result" style="display:none"></div>

    </div>
  </div>

<script>
/* --------- CONFIG: paste your Apps Script web app URL here --------- */
const SHEET_WEBHOOK = "https://script.google.com/a/macros/goa.bits-pilani.ac.in/s/AKfycbxip3hRHl275e1IEcofk_2FoxiKKPZ7hnjgFO68BRZqpJ1opaWc--XDSclbr4rG0pG6CA/exec"; // <-- paste your Apps Script web app URL here (https://script.google.com/macros/s/AKfycbx.../exec)
// optional secret token to include with payload (also implement checking in Apps Script if you want)
const SECRET_TOKEN = ""; // optional, leave blank if not used
/* ------------------------------------------------------------------ */

const POP_COUNTS = { India: { female: 685900000 }, World: { female: 4093903832 } };

const stats = {
  "World": {male:{mean:171,sd:7.59}, female:{mean:159,sd:7.07}},
  "India": {male:{mean:165,sd:7.0}, female:{mean:152,sd:6.8}},
  "United States": {male:{mean:176,sd:7.6}, female:{mean:163,sd:7.0}}
};
const bodyMult = {fit:1.18, average:1.0, stocky:0.92, slim:0.97};

function parseHeight(s){
  if(!s) return null;
  s = s.trim();
  if(/^\d+$/.test(s)){ const v = Number(s); if(v > 100 && v < 230) return v; }
  let m = s.match(/^(\d+)\s*(?:'|ft|ft\.?|\s)\s*(\d+)\s*\"?$/i);
  if(m){ const f = parseInt(m[1],10); const inch = parseInt(m[2],10); if(inch >=0 && inch <= 11) return Math.round((f*12 + inch)*2.54); }
  m = s.match(/^(\d+)\.(\d+)$/);
  if(m){ const f = parseInt(m[1],10); const frac = parseInt(m[2],10); if(frac >=0 && frac <= 11) return Math.round((f*12 + frac)*2.54); }
  m = s.match(/^(\d+)\s*'\s*$/);
  if(m){ const f = parseInt(m[1],10); return Math.round((f*12)*2.54); }
  return null;
}
function erf(x){ const sign = x<0?-1:1; x=Math.abs(x); const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911; const t=1/(1+p*x); const y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x); return sign*y; }
function normCdf(x,mean,sd){ return 0.5*(1+erf((x-mean)/(sd*Math.SQRT2))); }
function numberWithCommas(x){ return Math.round(x).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }

/* body type UI */
let bodySelected = 'fit';
document.querySelectorAll('.type').forEach(el=>{
  el.addEventListener('click', ()=>{
    document.querySelectorAll('.type').forEach(x=>x.classList.remove('sel'));
    el.classList.add('sel'); bodySelected = el.dataset.val;
  });
});

function suggestBodyType(bmi){
  if(bmi === null) return 'No suggestion (provide weight to get BMI suggestion)';
  if(bmi < 18.5) return 'Slim (or consider building muscle for a fit look)';
  if(bmi < 22.5) return 'Fit';
  if(bmi < 25) return 'Average to Fit';
  if(bmi < 30) return 'Average (consider fitness goals if desired)';
  return 'Stocky (consider fitness if you want a fitter look)';
}

/* main calculation & submission */
document.getElementById('calc').addEventListener('click', async ()=>{
  const name = (document.getElementById('name').value || '').trim();
  const gender = document.getElementById('gender').value;
  const country = document.getElementById('country').value || 'World';
  const hraw = document.getElementById('height').value;
  const hcm = parseHeight(hraw);
  const weight = parseFloat(document.getElementById('weight').value) || null;
  const ageRaw = document.getElementById('age').value;
  const age = ageRaw ? parseInt(ageRaw, 10) : null;

  if(!name){ alert("Please enter your name (required)."); document.getElementById('name').focus(); return; }
  if(!age || age < 18){ alert("This calculator is for users 18 years and older."); return; }
  if(!hcm){ alert("Please enter a valid height (cm or feet'in like 5'8)."); return; }

  const local = stats[country] || stats['World'];
  const world = stats['World'];
  function fracOlderThan(x, mean=30, sd=10){ return 1 - normCdf(x, mean, sd); }

  let oppEligibleLocal = 0, oppEligibleWorld = 0, compLocal = 0, compWorld = 0;

  if(gender === 'male'){
    oppEligibleLocal = normCdf(hcm, local['female'].mean, local['female'].sd);
    oppEligibleWorld = normCdf(hcm, world['female'].mean, world['female'].sd);
    compLocal = (1 - normCdf(hcm, local['male'].mean, local['male'].sd)) * 0.88;
    compWorld = (1 - normCdf(hcm, world['male'].mean, world['male'].sd)) * 0.88;
  } else {
    const menTallerLocal = 1 - normCdf(hcm, local['male'].mean, local['male'].sd);
    const menTallerWorld = 1 - normCdf(hcm, world['male'].mean, world['male'].sd);
    let ageFilterLocal = 1.0, ageFilterWorld = 1.0;
    if(age){ ageFilterLocal = fracOlderThan(age); ageFilterWorld = fracOlderThan(age); }

    let bmiMultAdj = 1.0;
    if(weight && hcm){
      const hh = hcm/100;
      const bmiLocal = weight/(hh*hh);
      if(bmiLocal < 17.5) bmiMultAdj = 0.92;
      else if(bmiLocal < 19.5) bmiMultAdj = 1.05;
      else if(bmiLocal < 23.5) bmiMultAdj = 1.12;
      else if(bmiLocal < 26) bmiMultAdj = 1.02;
      else bmiMultAdj = 0.94;
    }

    const femaleHeightMeanPrefLocal = local['female'].mean + 2;
    const femaleHeightMeanPrefWorld = world['female'].mean + 1;
    const femaleHeightSdPref = 8.5;
    const heightScoreLocal = Math.exp(-Math.pow(hcm - femaleHeightMeanPrefLocal, 2) / (2 * Math.pow(femaleHeightSdPref, 2)));
    const heightScoreWorld = Math.exp(-Math.pow(hcm - femaleHeightMeanPrefWorld, 2) / (2 * Math.pow(femaleHeightSdPref, 2)));

    let agePref = 1.0;
    if(age){
      if(age < 20) agePref = 0.98;
      else if(age < 30) agePref = 1.05;
      else if(age < 40) agePref = 1.0;
      else agePref = 0.95;
    }

    const attractivenessLocal = heightScoreLocal * bmiMultAdj * agePref;
    const attractivenessWorld = heightScoreWorld * bmiMultAdj * agePref;

    oppEligibleLocal = Math.min(0.95, 0.40 + attractivenessLocal * 0.55);
    oppEligibleWorld = Math.min(0.95, 0.40 + attractivenessWorld * 0.55);

    compLocal = 1 - normCdf(hcm, local['female'].mean, local['female'].sd);
    compWorld = 1 - normCdf(hcm, world['female'].mean, world['female'].sd);
  }

  let bmiMult = 1.0; let bmiVal = null;
  if(weight){ const hh = hcm/100; bmiVal = weight/(hh*hh);
    if(bmiVal < 18.5) bmiMult = 0.92;
    else if(bmiVal < 25) bmiMult = 1.02;
    else if(bmiVal < 30) bmiMult = 0.97;
    else bmiMult = 0.88;
  }

  let ageMult = 1.0;
  if(gender==='male' && age){ ageMult = 1 + Math.max(-0.12, Math.min(0.25, (age-25)/80)); }

  function availabilityFor(genderVal, hcmVal){
    if(genderVal==='male'){
      const base = 0.55;
      const extra = Math.min(0.20, Math.max(0, (hcmVal - 177) / 50));
      return base + extra;
    }
    return 0.46;
  }

  function finalCalc(W, M, genderVal, hcmVal){
    let raw = Math.max(0, W - M);
    const mult = bodyMult[bodySelected] || 1.0;
    const avail = availabilityFor(genderVal, hcmVal);
    let adj = raw * mult * bmiMult * ageMult * avail;
    adj = Math.max(0, Math.min(0.94, adj));
    return {raw,adj};
  }

  const localR = finalCalc(oppEligibleLocal, compLocal, gender, hcm);
  const worldR = finalCalc(oppEligibleWorld, compWorld, gender, hcm);

  /* Age-filtered population counts (no minors) */
  const indiaFemaleTotal = POP_COUNTS.India.female;
  const worldFemaleTotal = POP_COUNTS.World.female;
  const indiaUnder18Fraction = 0.19;
  const worldUnder18Fraction = 0.23;
  let indiaAdultFemale = indiaFemaleTotal * (1 - indiaUnder18Fraction);
  let worldAdultFemale = worldFemaleTotal * (1 - worldUnder18Fraction);

  function ageFilteredPool(totalAdult, userAge){
    if(!userAge || userAge < 18) return Math.round(totalAdult);
    const maxAge = Math.min(60, userAge + 10);
    const eligibleFraction = Math.max(0, (maxAge - 18) / (60 - 18));
    return Math.round(totalAdult * eligibleFraction);
  }

  let indiaTargetCount = Math.round(indiaAdultFemale);
  let worldTargetCount = Math.round(worldAdultFemale);

  if(gender === 'male'){
    indiaTargetCount = ageFilteredPool(indiaAdultFemale, age);
    worldTargetCount = ageFilteredPool(worldAdultFemale, age);
  } else {
    const INDIA_TOTAL = 1463865525;
    const WORLD_TOTAL = 8090000000;
    indiaTargetCount = Math.round(Math.max(0, INDIA_TOTAL - indiaFemaleTotal));
    worldTargetCount = Math.round(Math.max(0, WORLD_TOTAL - worldFemaleTotal));
  }

  const indiaPossible = Math.round(localR.adj * indiaTargetCount);
  const worldPossible = Math.round(worldR.adj * worldTargetCount);

  const toPct = x => (x*100).toFixed(1) + '%';
  const bmiText = bmiVal ? bmiVal.toFixed(1) : 'n/a';
  const suggestion = suggestBodyType(bmiVal);
  const displayName = name ? (name + ', ') : '';
  const targetWord = (gender==='male') ? 'women' : 'men';

  const out = `
    <div class="flex-sb">
      <div class="box">
        <strong>In your country (${country}):</strong>
        <div style="font-size:18px;margin-top:6px">${toPct(localR.adj)}</div>
        <div class="small">raw eligible fraction: ${toPct(localR.raw)}</div>
        <div class="small" style="margin-top:8px">Estimated ${targetWord} available in ${country}: <strong>${numberWithCommas(indiaTargetCount)}</strong></div>
        <div class="small">You can rizz up approximately <strong>${numberWithCommas(indiaPossible)}</strong> ${targetWord} in ${country}.</div>
      </div>
      <div class="box">
        <strong>In the world:</strong>
        <div style="font-size:18px;margin-top:6px">${toPct(worldR.adj)}</div>
        <div class="small">raw eligible fraction: ${toPct(worldR.raw)}</div>
        <div class="small" style="margin-top:8px">Estimated ${targetWord} worldwide: <strong>${numberWithCommas(worldTargetCount)}</strong></div>
        <div class="small">You can rizz up approximately <strong>${numberWithCommas(worldPossible)}</strong> ${targetWord} worldwide.</div>
      </div>
    </div>
    <div style="margin-top:10px" class="small">BMI: <strong>${bmiText}</strong> &nbsp; — Suggested body type: <strong>${suggestion}</strong></div>
    <div style="margin-top:8px" class="small">${displayName}Kind note: this doesn't consider your humour, kindness, or personality — rizz is more than stats. ❤️</div>
  `;
  const res = document.getElementById('result'); res.innerHTML = out; res.style.display = 'block';

  // -- auto-submit to Apps Script webhook (Sheet) if webhook configured --
  if(SHEET_WEBHOOK){
    const payload = {
      name: name,
      gender: gender,
      country: country,
      age: age,
      height: hcm,
      weight: weight || '',
      bmi: bmiVal || '',
      resultCountry: toPct(localR.adj),
      resultWorld: toPct(worldR.adj),
      countCountry: indiaPossible,
      countWorld: worldPossible,
      secret: SECRET_TOKEN || ''
    };
    try{
      await fetch(SHEET_WEBHOOK, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      console.log("Submitted to Sheet webhook (attempted).");
    }catch(e){
      console.warn("Submission to webhook failed:", e);
    }
  }
});
</script>
</body>
</html>
